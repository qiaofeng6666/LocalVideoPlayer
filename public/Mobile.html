<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon/M.ico" type="image/x-icon">
    <title>æ‰‹æœºç‰ˆè§†é¢‘æ’­æ”¾å™¨</title>
    <style>
        /* é»˜è®¤ï¼ˆæ·±è‰²ï¼‰ä¸»é¢˜æ ·å¼ */
        :root {
            --background-color: #333;
            --text-color: white;
            --highlight-background-color: gray;
            --highlight-text-color: #00AEEC;
        }

        /* æµ…è‰²ä¸»é¢˜æ ·å¼ */
        :root.theme {
            --background-color: white;
            --text-color: #333;
            --highlight-background-color: white;
            --highlight-text-color: #00AEEC;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: Arial, sans-serif;
        }

        .video-item {
            padding: 10px;
            border: 1px solid #ddd;
            margin-bottom: 5px;
            cursor: pointer;
            display: flex;
            align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
            transition: all 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
            background-color: var(--background-color);
            color: var(--text-color);
        }

        /* ç‚¹å‡»åçš„æ ·å¼ */
        .clicked {
            background-color: var(--highlight-background-color); /* ä½¿ç”¨å˜é‡ */
            color: var(--highlight-text-color); /* ä½¿ç”¨å˜é‡ */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* é˜´å½±æ•ˆæœ */
        }

        /* å›¾ç‰‡æ ·å¼ */
        .icon {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }

        .button-container {
            display: flex; /* é»˜è®¤æ˜¾ç¤ºæŒ‰é’® */
            position: fixed; /* å›ºå®šå®šä½ */
            bottom: 45px; /* è·ç¦»åº•éƒ¨çš„è·ç¦» */
            right: 5px; /* è·ç¦»å³ä¾§çš„è·ç¦» */
            flex-direction: column-reverse; /* ä½¿å†…å®¹ä»ä¸‹å¾€ä¸Šæ’åˆ— */
            justify-content: flex-end; /* ç¡®ä¿å†…å®¹å¯¹é½åˆ°å®¹å™¨åº•éƒ¨ */
            gap: 5px; /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
        }

        .button {
            width: 40px; /* å›ºå®šå®½åº¦ */
            height: 40px; /* å›ºå®šé«˜åº¦ */
            background-color: #007bff; /* æŒ‰é’®èƒŒæ™¯é¢œè‰² */
            color: white;
            border: none;
            cursor: pointer; /* å½“é¼ æ ‡æ‚¬åœåœ¨æŒ‰é’®ä¸Šæ—¶ï¼Œå…‰æ ‡ä¼šå˜æˆæ‰‹å‹ï¼Œæç¤ºç”¨æˆ·è¿™æ˜¯ä¸€ä¸ªå¯ç‚¹å‡»çš„æŒ‰é’® */
            border-radius: 5px;
            font-size: 16px;
            opacity: 0.8; /* åˆå§‹é€æ˜åº¦ */
            transition: opacity 0.3s ease; /* å¹³æ»‘è¿‡æ¸¡æ•ˆæœ */
        }

        .button:hover {
            background-color: #0056b3; /* é¼ æ ‡æ‚¬åœæ—¶çš„èƒŒæ™¯é¢œè‰² */
        }

        .video-container {
            position: fixed;
            background-color: #333;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000; /* ç¡®ä¿è§†é¢‘æ’­æ”¾å™¨åœ¨æœ€ä¸Šå±‚ */
        }

        /* è§†é¢‘æ’­æ”¾å™¨æ ·å¼ */
        video {
            width: 100%;
            height: 221px;
 
        }

        .video-list-container {
            flex: 1 0 auto;
            overflow-y: auto;
            margin-top: 240px; /* æ ¹æ®è§†é¢‘æ’­æ”¾å™¨çš„é«˜åº¦è°ƒæ•´æ­¤å€¼ */
            padding-bottom: 60px; /* æ ¹æ®æŒ‰é’®æ çš„é«˜åº¦è°ƒæ•´æ­¤å€¼ */
        }

        .video-list-container ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }

        .video-list-container li {
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }

        .video-list-container a {
            text-decoration: none;
            color: black;
            display: block;
        }

        .video-item {
            cursor: pointer;
            padding: 10px;
            border: 1px solid #ccc;
            margin-bottom: 5px;
        }

        /* æœç´¢åŸºæœ¬æ ·å¼ */
        .videoAndSearch{
            display: flex;
            font-size: 24px;
        }
        .search-container {
            display: flex;
            justify-content: flex-end; /* ä½¿å†…å®¹é å³å¯¹é½ */
            margin-left: auto; /* å¼ºåˆ¶å®¹å™¨é å³ */
            align-items: center; /* å‚ç›´å±…ä¸­å¯¹é½ */
            width: 210px;
            right: 0; /* é å³å¯¹é½ */
            top: 20px; /* æ ¹æ®éœ€è¦è°ƒæ•´é¡¶éƒ¨è·ç¦» */
        }
        .search-container > * {
            margin: 5px 1px;
        }
        input[type=text] {
            padding: 5px;
            width: 50%;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            padding: 5px 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .highlight {
            background-color: yellow;
        }
        .result-message {
            font-weight: bold;
            display: none;
        }
        .error-message {
            color: red;
            display: none;
        }

        /* è¿›åº¦æ¡æ§åˆ¶ */
        input[type=range] {
            width: 95%;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed; /* å›ºå®šå®šä½ */
            bottom: 0; /* å›ºå®šåœ¨å±å¹•åº•éƒ¨ */
            left: 0;
            right: 0;
            background-color: var(--background-color);
            padding: 5px;
            border-top: 1px solid #ccc;
            z-index: 1000; /* ç¡®ä¿åœ¨å…¶ä»–å†…å®¹ä¹‹ä¸Š */
        }

        .controls button {
            padding: 2px;
            font-size: 24px; /* å¢å¤§å­—ä½“ä»¥ç¡®ä¿ç¬¦å·æ¸…æ™°å¯è§ */
            font-weight: bold; /* åŠ ç²—å­—ä½“ */
            cursor: pointer;
            border: none; /* å»æ‰æŒ‰é’®è¾¹æ¡† */
            background-color: transparent; /* è®¾ç½®èƒŒæ™¯é€æ˜ */
        }

        .controls button:hover {
            background-color: #ddd; /* é¼ æ ‡æ‚¬åœæ—¶æ”¹å˜èƒŒæ™¯é¢œè‰² */
        }
    </style>
</head>

<body>
    <div class="button-container">
        <!-- åˆ‡æ¢æ¨¡å¼æŒ‰é’® -->
        <button class="button" id="themeToggle" onclick="toggleTheme()">ğŸ”†</button>
        <!-- é€Ÿåº¦åˆ‡æ¢æŒ‰é’® -->
        <button class="button" id="speedBtn">1x</button>
        <!-- æ»šåˆ°åº•éƒ¨æŒ‰é’® -->
        <button class="button" id="scrollToBtm" class="UpDownBtm" title="æ»šåˆ°åº•éƒ¨">â†“</button>
        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <button class="button" id="backToTopBtn" class="UpDownBtm" title="è¿”å›é¡¶éƒ¨" style="display: none;">â†‘</button>     
    </div>

    <script>
        // åˆ‡æ¢ä¸»é¢˜å‡½æ•°
        function toggleTheme() {
            var themeToggle = document.getElementById('themeToggle');
            document.documentElement.classList.toggle('theme');
            if (document.documentElement.classList.contains('theme')) {
                themeToggle.textContent = 'ğŸŒ™';
            } else {
                themeToggle.textContent = 'ğŸ”†';
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜ç»‘å®šç‚¹å‡»äº‹ä»¶åˆ°çˆ¶çº§å…ƒç´ 
            document.body.addEventListener('click', function(event) {
                if (event.target.closest('.video-item')) {
                    var item = event.target.closest('.video-item');

                    // ç§»é™¤æ‰€æœ‰é¡¹ç›®çš„ç‰¹æ®Šæ ·å¼å’Œå›¾æ ‡
                    document.querySelectorAll('.video-item').forEach(function(otherItem) {
                        otherItem.classList.remove('clicked');
                        otherItem.classList.add('default'); // è¿˜åŸé»˜è®¤æ ·å¼

                    // ç§»é™¤ä¹‹å‰å¯èƒ½å­˜åœ¨çš„å›¾ç‰‡å…ƒç´ 
                    if (otherItem.querySelector('.icon')) {
                        otherItem.removeChild(otherItem.querySelector('.icon'));
                    }
                });

                // ç»™å½“å‰ç‚¹å‡»çš„é¡¹ç›®æ·»åŠ ç‰¹æ®Šæ ·å¼å’Œå›¾æ ‡
                item.classList.remove('default');
                item.classList.add('clicked');

                // åˆ›å»ºå¹¶æ’å…¥å›¾ç‰‡å…ƒç´ 
                var img = document.createElement('img');
                img.src = '/asserts/playing.gif';
                img.alt = 'Playing Icon';
                img.className = 'icon';
                item.insertBefore(img, item.firstChild);
                }
            });
        });
    </script>

    <!-- è§†é¢‘æ’­æ”¾å™¨ -->
    <div class="video-container">
        <video id="main-video" controls></video>
    </div>

    <!-- è§†é¢‘åˆ—è¡¨ -->
    <div class="video-list-container">
        <div class="videoAndSearch">
            <div id="videosName">è§†é¢‘åˆ—è¡¨</div>
            <div class="search-container">
                <!-- ç»“æœä¿¡æ¯æ˜¾ç¤ºåœ¨æœç´¢æ¡†å‰é¢ -->
                <div class="result-message" id="resultMessage"></div>
                <div class="error-message" id="errorMessage">è¯·è¾“å…¥æœç´¢å…³é”®è¯ã€‚</div>
                <input type="text" id="searchText" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯...">
                <button onclick="findText()">æœç´¢</button>
            </div>
        </div>
        <div id="videoItems"></div>
    </div>

    <div class="controls">
        <button id="rewindBtn"> âª </button>
        <input type="range" id="seekBar" min="0" max="100" value="0">
        <button id="fastForwardBtn"> â© </button>
    </div>

    <!-- è¿›åº¦æ¡æ§åˆ¶ -->
    <script>
        var video = document.getElementById('main-video');
        var seekBar = document.getElementById('seekBar');
        var rewindBtn = document.getElementById('rewindBtn');
        var fastForwardBtn = document.getElementById('fastForwardBtn');
        var speedBtn = document.getElementById('speedBtn');

        // æ›´æ–°è¿›åº¦æ¡
        function updateSeekBar() {
            if (video.duration) {
                var progress = (video.currentTime / video.duration) * 100;
                seekBar.value = progress;
            }
        }

        // ç›‘å¬è¿›åº¦æ¡è¾“å…¥äº‹ä»¶ï¼ˆå®æ—¶æ›´æ–°ï¼‰
        seekBar.addEventListener('input', function() {
            var time = (seekBar.value / 100) * video.duration;
            video.currentTime = time;
        });

        // ç›‘å¬è¿›åº¦æ¡å˜æ›´äº‹ä»¶ï¼ˆç”¨æˆ·é‡Šæ”¾é¼ æ ‡åæ›´æ–°ï¼‰
        seekBar.addEventListener('change', function() {
            var time = (seekBar.value / 100) * video.duration;
            video.currentTime = time;
        });

        // å¿«é€€æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        rewindBtn.addEventListener('click', function() {
            video.currentTime = Math.max(video.currentTime - 3, 0);
        });

        // å¿«è¿›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        fastForwardBtn.addEventListener('click', function() {
            video.currentTime = Math.min(video.currentTime + 3, video.duration);
        });

        // è®¾ç½®æ’­æ”¾é€Ÿåº¦
        let currentSpeedIndex = 0;
        const speeds = [1.0, 2.0, 3.0];
        let savedPlaybackRate = speeds[currentSpeedIndex]; // ä¿å­˜å½“å‰æ’­æ”¾é€Ÿåº¦

        // åˆ‡æ¢è§†é¢‘æ—¶é‡ç½®è¿›åº¦æ¡å’Œæ’­æ”¾é€Ÿåº¦
        function resetSeekBarAndSpeed() {
            // åœ¨æ–°è§†é¢‘åŠ è½½å®Œæˆåæ¢å¤æ’­æ”¾é€Ÿåº¦
            video.addEventListener('loadeddata', function() {
                video.playbackRate = savedPlaybackRate;
                speedBtn.textContent = `${savedPlaybackRate}x`;
                video.play(); // è‡ªåŠ¨æ’­æ”¾æ–°è§†é¢‘
            }, { once: true });
        }

        // è®¾ç½®æ’­æ”¾é€Ÿåº¦
        function setPlaybackSpeed(index) {
            currentSpeedIndex = index;
            video.playbackRate = speeds[currentSpeedIndex];
            speedBtn.textContent = `${speeds[currentSpeedIndex]}x`;
        }

        speedBtn.addEventListener('click', function() {
            currentSpeedIndex = (currentSpeedIndex + 1) % speeds.length;
            setPlaybackSpeed(currentSpeedIndex);
        });

        // é¡µé¢åŠ è½½æ—¶è®¾ç½®é»˜è®¤æ’­æ”¾é€Ÿåº¦
        window.onload = function() {
            setPlaybackSpeed(0); // é»˜è®¤è®¾ç½®ä¸º1x
        };

        // ç›‘å¬æ’­æ”¾é€Ÿåº¦å˜åŒ–å¹¶æ›´æ–°æŒ‰é’®æ–‡æœ¬
        video.addEventListener('ratechange', function() {
            const currentRate = video.playbackRate;
            for (let i = 0; i < speeds.length; i++) {
                if (speeds[i] === currentRate) {
                    currentSpeedIndex = i;
                    break;
                }
            }
            speedBtn.textContent = `${currentRate}x`;
        });
    </script>

    <!-- æ»šé¡¶æŒ‰é’® -->
    <script>
        // è·å–æ»šåˆ°åº•éƒ¨æŒ‰é’®
        const scrollToBtm = document.getElementById('scrollToBtm');
        // è·å–è¿”å›é¡¶éƒ¨æŒ‰é’®
        const backToTopBtn = document.getElementById('backToTopBtn');

        // ç›‘å¬æ»šåŠ¨äº‹ä»¶ï¼Œå½“ç”¨æˆ·æ»šåŠ¨è¶…è¿‡ä¸€å®šè·ç¦»æ—¶æ˜¾ç¤ºæŒ‰é’®
        window.addEventListener('scroll', () => {
            if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                backToTopBtn.style.display = 'block';
            } else {
                backToTopBtn.style.display = 'none';
            }
        });

        // ç‚¹å‡»æŒ‰é’®æ—¶å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth' // å¹³æ»‘æ»šåŠ¨
            });
        });

        // ç‚¹å‡»æŒ‰é’®æ—¶å¹³æ»‘æ»šåŠ¨åˆ°åº•éƒ¨
        scrollToBtm.addEventListener('click', () => {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth' // å¹³æ»‘æ»šåŠ¨
            });
        });
    </script>   

    <!-- è·å–è§†é¢‘ -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const videoItemsContainer = document.getElementById('videoItems');
            const videoPlayer = document.getElementById('main-video');

            // è·å–è§†é¢‘åˆ—è¡¨
            fetch('/api/videos')
                .then(response => response.json())
                .then(videos => {
                    videos.forEach(videoPath => {
                        const videoItem = document.createElement('div');
                        videoItem.className = 'video-item';
                        videoItem.textContent = decodeURIComponent(videoPath.split('/').pop()); // æ˜¾ç¤ºæ–‡ä»¶å
                        videoItem.onclick = () => playVideo(videoPath);
                        videoItemsContainer.appendChild(videoItem);
                    });
                    updateCount();
                })
                .catch(err => console.error('è·å–è§†é¢‘åˆ—è¡¨å¤±è´¥:', err));

            function playVideo(videoPath) {
                savedPlaybackRate = speeds[currentSpeedIndex]; // ä¿å­˜å½“å‰æ’­æ”¾é€Ÿåº¦
                videoPlayer.src = videoPath;
                videoPlayer.load(); // åŠ è½½æ–°çš„è§†é¢‘æº
                videoPlayer.play();
                resetSeekBarAndSpeed();
            }

        });

        function updateCount() {
            const parent = document.getElementById('videoItems');
            const childDivs = parent.querySelectorAll(':scope > div'); // è·å–æ‰€æœ‰ç›´æ¥å­div
            document.getElementById('videosName').innerText = 'è§†é¢‘åˆ—è¡¨ï¼š' + childDivs.length;
        }
    </script>

    <!-- æœç´¢ -->
    <script>
        function findText() {
            // è·å–ç”¨æˆ·è¾“å…¥çš„æœç´¢è¯
            var searchText = document.getElementById('searchText').value.trim();
            var resultMessage = document.getElementById('resultMessage');

            // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯æˆ–æ‰§è¡Œæœç´¢é€»è¾‘
            if (searchText === '') {
                resultMessage.style.display = 'none';
                return;
            } else {
                errorMessage.style.display = 'none';
            }

            // è·å–ç›®æ ‡ div å…ƒç´ 
            var videoItemsDiv = document.getElementById('videoItems');

            // ç§»é™¤ä¹‹å‰çš„é«˜äº®æ˜¾ç¤º
            var highlightedElements = videoItemsDiv.querySelectorAll(".highlight");
            highlightedElements.forEach(function (item) {
                item.outerHTML = item.innerHTML.replace(/<span class="highlight">|<\/span>/g, '');
            });

            // æŸ¥æ‰¾å¹¶é«˜äº®åŒ¹é…çš„æ–‡æœ¬ - ä»…å¯¹ç‰¹å®š div ä¸­çš„æ–‡æœ¬è¿›è¡Œæ“ä½œ
            var pattern = new RegExp(searchText, "gi");
            var matchCount = 0;

            videoItemsDiv.querySelectorAll('*').forEach(function (element) {
                if (element.childNodes.length && element.tagName !== 'SCRIPT') { // ç¡®ä¿ä¸å¤„ç† script æ ‡ç­¾
                    var originalText = element.innerHTML;
                    var modifiedText = originalText.replace(pattern, function (match) {
                        matchCount++;
                        return '<span class="highlight">' + match + '</span>';
                    });
                    element.innerHTML = modifiedText;
                }
            });

            // æ˜¾ç¤ºç»“æœä¿¡æ¯
            if (matchCount > 0) {
                resultMessage.textContent = `${matchCount}`;
                resultMessage.style.color = 'green';
            } else {
                resultMessage.textContent = 'æ— ';
                resultMessage.style.color = 'red';
            }
            resultMessage.style.display = 'block';
        }
    </script>

    <!--é•¿æŒ‰åŠ é€Ÿ-->
    <script>
        // è·å–videoå…ƒç´ 
        var vid = document.getElementById("main-video");

        // è®°å½•åˆå§‹æ’­æ”¾é€Ÿåº¦
        var defaultSpeed = vid.playbackRate;
        
        // é˜»æ­¢é•¿æŒ‰è§†é¢‘æ—¶çš„é»˜è®¤èœå•
        vid.addEventListener('contextmenu', function(event) {
            event.preventDefault();
        });

        // ç›‘å¬è§¦æ‘¸å¼€å§‹äº‹ä»¶
        vid.addEventListener('touchstart', function() {
            // è®°å½•åˆå§‹æ’­æ”¾é€Ÿåº¦
            defaultSpeed = vid.playbackRate;
            // è®¾ç½®æ’­æ”¾é€Ÿåº¦ä¸º3x
            vid.playbackRate = 3;
        });
        
        // ç›‘å¬è§¦æ‘¸ç»“æŸäº‹ä»¶
        vid.addEventListener('touchend', function() {
            // æ¢å¤åˆå§‹æ’­æ”¾é€Ÿåº¦
            vid.playbackRate = defaultSpeed;
        });
    </script>
</body>
</html>